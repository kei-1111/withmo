name: Notify Discord

on:
  pull_request:
    types: [opened, closed, review_requested]
  issues:
    types: [opened, closed]
  issue_comment:
    types: [created]
  release:
    types: [published]
  workflow_run:
    types:
      - completed

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    if: ${{ always() }} # workflow_runã®å¤±æ•—ã§ã‚‚é€šçŸ¥ã—ãŸã„ã®ã§
    steps:
      - name: Send message to Discord
        run: |
          # PRä½œæˆ
          if [[ "${{ github.event_name }}" == "pull_request" && "${{ github.event.action }}" == "opened" ]]; then
            curl -H "Content-Type: application/json" \
              -d "{\"content\": \"ğŸ”” **Pull Request ä½œæˆ**\n${{ github.actor }}ã‚ˆã‚Šã€PRã€Œ${{ github.event.pull_request.title }}ã€ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚\n${{ github.event.pull_request.html_url }}\"}" \
              ${{ secrets.DISCORD_WEBHOOK_URL }}

          # PRãƒãƒ¼ã‚¸
          elif [[ "${{ github.event_name }}" == "pull_request" && "${{ github.event.action }}" == "closed" && "${{ github.event.pull_request.merged }}" == "true" ]]; then
            curl -H "Content-Type: application/json" \
              -d "{\"content\": \"âœ… **Pull Request ãƒãƒ¼ã‚¸**\n${{ github.actor }}ã‚ˆã‚Šã€PRã€Œ${{ github.event.pull_request.title }}ã€ãŒãƒãƒ¼ã‚¸ã•ã‚Œã¾ã—ãŸã€‚\n${{ github.event.pull_request.html_url }}\"}" \
              ${{ secrets.DISCORD_WEBHOOK_URL }}

          # PRãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
          elif [[ "${{ github.event_name }}" == "pull_request" && "${{ github.event.action }}" == "review_requested" ]]; then
            reviewer="${{ github.event.requested_reviewer.login }}"
            curl -H "Content-Type: application/json" \
              -d "{\"content\": \"ğŸ‘€ **ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**\n${{ github.actor }}ã‚ˆã‚Šã€${reviewer}ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè¡Œã‚ã‚Œã¾ã—ãŸã€‚\nPR: ${{ github.event.pull_request.html_url }}\"}" \
               ${{ secrets.DISCORD_WEBHOOK_URL }}
  
          # Issueä½œæˆ
          elif [[ "${{ github.event_name }}" == "issues" && "${{ github.event.action }}" == "opened" ]]; then
            curl -H "Content-Type: application/json" \
              -d "{\"content\": \"ğŸ“Œ **Issue ä½œæˆ**\n${{ github.actor }}ã‚ˆã‚Šã€Issueã€Œ${{ github.event.issue.title }}ã€ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚\n${{ github.event.issue.html_url }}\"}" \
              ${{ secrets.DISCORD_WEBHOOK_URL }}

          # Issueã‚¯ãƒ­ãƒ¼ã‚º
          elif [[ "${{ github.event_name }}" == "issues" && "${{ github.event.action }}" == "closed" ]]; then
            curl -H "Content-Type: application/json" \
              -d "{\"content\": \"âœ… **Issue ã‚¯ãƒ­ãƒ¼ã‚º**\n${{ github.actor }}ã‚ˆã‚Šã€Issueã€Œ${{ github.event.issue.title }}ã€ãŒã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¾ã—ãŸã€‚\n${{ github.event.issue.html_url }}\"}" \
              ${{ secrets.DISCORD_WEBHOOK_URL }}

          # Issueã‚³ãƒ¡ãƒ³ãƒˆ
          elif [[ "${{ github.event_name }}" == "issue_comment" && "${{ github.event.action }}" == "created" ]]; then
            curl -H "Content-Type: application/json" \
              -d "{\"content\": \"ğŸ’¬ **Issue ã‚³ãƒ¡ãƒ³ãƒˆ**\n${{ github.actor }}ã‚ˆã‚Šã€Issueã«ã‚³ãƒ¡ãƒ³ãƒˆãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚\nã‚³ãƒ¡ãƒ³ãƒˆ: ${{ github.event.comment.body }}\n${{ github.event.issue.html_url }}\"}" \
              ${{ secrets.DISCORD_WEBHOOK_URL }}

          # CI/CDå¤±æ•—
          elif [[ "${{ github.event_name }}" == "workflow_run" && "${{ github.event.workflow_run.conclusion }}" == "failure" ]]; then
            curl -H "Content-Type: application/json" \
              -d "{\"content\": \"âŒ **CI/CD å¤±æ•—**\nWorkflowã€Œ${{ github.event.workflow_run.name }}ã€ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚\nè©³ç´°: ${{ github.event.workflow_run.html_url }}\"}" \
              ${{ secrets.DISCORD_WEBHOOK_URL }}
